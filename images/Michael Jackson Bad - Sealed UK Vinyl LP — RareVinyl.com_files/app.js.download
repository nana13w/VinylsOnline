"use strict";function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _createForOfIteratorHelper(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,i=function(){};return{s:i,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,r=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return r=e.done,e},e:function(e){c=!0,a=e},f:function(){try{r||null==n.return||n.return()}finally{if(c)throw a}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){_defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!==_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}!function(){window.HIKO=_objectSpread(_objectSpread({},window.HIKO),{},{extension:!0,ajax_calls:0,popup:b});var e=30,t={replace:!0,return_url:!0,enable:!0,key:"retry"},n={};if(function(e){e||(e="info");for(var t={debug:2,info:3,warn:4,error:5},o=0,i=Object.keys(t);o<i.length;o++){var a=i[o];n[a]=t[a]<t[e]?function(){}:console[a].bind(window.console,"".concat(a.toUpperCase(),": "))}n.debug("init log ".concat(e))}(function(){if(!document.currentScript)return{};var e=new URLSearchParams(document.currentScript.src);return{cid:e.get("cid"),level:e.get("level")}}().level),window.HIKO.script)n.debug("script > exit");else{var o="hiko_socials",i="abw",a="g_id_onload",r="g_id_marketing",c="visited",d=/^\w+((-\w+)|(\.\w+))*@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z]+$/;if(!(location.protocol.indexOf("http")<0||/^(\/[a-zA-Z]{2,3}(-[a-zA-Z]{2})?)?\/challenge($|\?)/.test(location.pathname))){var l="",u="en",s="";g();var p,f=!1;document.addEventListener("hiko",(function(e){return n.debug("catch event: ".concat(JSON.stringify(e.detail)))})),n.debug("0904-1");var h=!1,m=k(location.href).ha;if(m&&/^[a-f0-9]{78,}$/.test(m))D(m).then(J);else{var v=k(location.href).hikotoken;v&&(n.debug("token ".concat(v," found")),S("POST","/apps/authapp/signin",{token:v}).then((function(e){e&&Object.keys(e).length&&(e.token?(Z(),L(e)):e.multipass?(Z(),j(e)):(Z(),P(e)))}))),document.addEventListener("onetap",(function(e){if(n.debug("catch onetap event: ".concat(JSON.stringify(e.detail))),"display"===e.detail.action){var t,o,i,c=document.getElementById(a),d=function(){if("iframe"===e.detail.type){var t=c.querySelector("iframe");if("0px"===getComputedStyle(t).getPropertyValue("bottom"))return t}var n=document.querySelector("#credential_picker_iframe");if(n)return n}(),l=p.onetap.email_marketing&&null!==(t=p.onetap.statement)&&void 0!==t&&t.enable?null===(o=p.onetap.statement)||void 0===o?void 0:o.content:null===(i=p.onetap.marketing)||void 0===i?void 0:i.content;d?(d.style.bottom="58px",c.insertAdjacentHTML("beforeend","<style> .otc { position: fixed; bottom: 0px; left: 0px; z-index: ".concat(d.style.zIndex,'; width; 100%; height: 60px; padding: 0 8px 0 8px;} .otc > div {background-color: white; border-top: 1px solid #dadce0;}</style>\n                <div id="').concat(r,'" class="otc">').concat(l,"</div>"))):e.detail.width&&c.insertAdjacentHTML("beforeend","<style> .otc { width: ".concat(e.detail.width,'px; padding: 0 8px 0 8px;} .otc > div {background-color: white; border-radius: 8px; box-shadow: 0 0 0 1px #dadce0;}</style>\n                <div id="').concat(r,'" class="otc">').concat(l,"</div>"));var u=c.querySelector("#".concat(r));u&&u.addEventListener("click",(function(e){return e.stopPropagation()}))}else if("hide"===e.detail.action){var s=document.getElementById(r);s&&(s.style.display="none")}})),new Promise((function(e){return y(e)})).then((function(){return new Promise((function(e,t){var i=_(o);if(null!=i&&i.version){if((p=i).locale&&u===p.locale)return e(i);n.debug("reload for locale change")}S("POST","/apps/authapp/load",{}).then((function(t){p=t,n.debug("init config"),x(o,t),e(t)})).catch((function(e){n.error(null==e?void 0:e.message),t()}))}))})).then((function(e){return p.delay?new Promise((function(t){setTimeout((function(){n.debug("delay ".concat(p.delay)),t(e)}),p.delay)})):Promise.resolve(e)})).then((function(e){var a;if(p=e,s){if(t.enable){var r=_(t.key);if(null!=r&&r.return_url){x(t.key,_objectSpread(_objectSpread({},r),{},{return_url:!1}));var d=new URLSearchParams(window.location.search).get("return_url");if(d)return void window.location.replace("https://".concat(window.location.hostname).concat(decodeURIComponent(d)))}}!function(){var e,t,n=_(i);n&&(S("POST","/apps/authapp/user",{id:n,cid:s}),x(i));if(!(null!==(e=p.avatar)&&void 0!==e&&e.profile||null!==(t=p.avatar)&&void 0!==t&&t.header))return;var o=_("hiko_"+s);void 0!==(null==o?void 0:o.avatar)?K(o):S("POST","/apps/authapp/avatar",{id:s,social:p.click||""}).then((function(e){x("hiko_"+s,e),K(e)})).catch((function(){}))}()}else{if(t.enable){var l=_(t.key);if(null!=l&&l.replace)return x(t.key,_objectSpread(_objectSpread({},l),{},{replace:!1})),void window.location.replace(window.location.href)}var u,f,h,m;document.querySelector('div[name="hiko-container"]')||document.querySelector('form[action*="/account"]')?z():x(c,location.pathname),null!==(a=p.onetap)&&void 0!==a&&a.enable&&new Promise((function(e){var t=document.createElement("iframe");t.id="3pc",t.src="https://apps.hiko.software/js/assets/cookie.html",t.style.display="none",t.style.position="fixed",document.body.appendChild(t),window.addEventListener("message",(function o(i){if("3pcSupported"===i.data||"3pcUnsupported"===i.data){var a=!1;"3pcUnsupported"===i.data&&(a=!0,n.info("no 3'rd party cookie")),document.body.removeChild(t),window.removeEventListener("message",o),e(a)}}),!1)})).then(A),function(){try{var e=new MutationObserver((function(e){e.forEach((function(e){"attributes"===e.type&&"lang"===e.attributeName&&(x(o),z()),"childList"===e.type&&e.addedNodes.length>0&&e.addedNodes.forEach((function(e){if(e.nodeType===Node.ELEMENT_NODE&&(e.querySelector('form[action*="/account"]')&&z(),"FORM"===e.nodeName)){var t,o=_createForOfIteratorHelper(e.attributes);try{for(o.s();!(t=o.n()).done;){var i=t.value;"action"===i.name&&(n.debug("add form ".concat(i.value)),i.value.indexOf("/account")>=0&&z())}}catch(e){o.e(e)}finally{o.f()}}}))}))}));e.observe(document.documentElement,{attributes:!0,attributeFilter:["lang"]}),e.observe(document.body,{childList:!0,subtree:!0})}catch(e){n.error(e.message)}}(),S("POST","/apps/authapp/load",{version:(u=_(o)).version,locale:u.locale}).then((function(e){var t;if(e.version&&u.version!==e.version||e.error){n.debug("config version ".concat(u.version," > ").concat(e.version)),x(o,e);var i=document.querySelectorAll('div[name="hiko-container"]');i.length&&(i.forEach((function(e){return e.remove})),p=e,z())}e.webview&&null!==(t=p.webview_hides)&&void 0!==t&&t.length&&document.querySelectorAll('div[name="hiko-container"]').forEach((function(e){p.webview_hides.forEach((function(t){var n=e.querySelector("div[data=".concat(t));n&&n.remove()}))}))})),null!==(f=p.ip)&&void 0!==f&&f.address||null!==(h=p.ip)&&void 0!==h&&h.disable||S("GET","https://api.ipify.org?format=json").then((function(e){null!=e&&e.ip&&(n.debug("ip ".concat(e.ip)),p.ip={address:e.ip},E(o,{ip:_objectSpread({},p.ip)}))})).catch((function(e){return n.debug("popup ip fail ".concat(null==e?void 0:e.message))})),(m=document.querySelectorAll(".hiko-dialog"))&&m.forEach((function(e){return e.onclick=b}))}}))}}}function g(){var e,t,n;l=null===(e=window.Shopify)||void 0===e?void 0:e.shop,u=(null===(t=window.Shopify)||void 0===t?void 0:t.locale)||"en",s=null===(n=window.__st)||void 0===n?void 0:n.cid}function y(e){var t;if(null!==(t=window.Shopify)&&void 0!==t&&t.shop&&window.__st)return g(),e();setTimeout((function(){return y(e)}),300)}function b(){if(window.hikodialog){window.hikodialogbuttons.querySelector("button").textContent="Sign-in with email link";var e=window.hikodialog.querySelector("#hiko-popup-message");window.hikodialogbuttons.style="display: flex;",e&&(e.style="display: none;")}else I(),document.body.insertAdjacentHTML("beforeend",'<dialog id="hikodialog" class="hikodialog">\n                    <h2>One-click sign-in</h2>\n                    <button onclick="window.hikodialog.close();" aria-label="close" class="x">❌</button>\n                    <div id="hikodialogbuttons" class="hiko-dialog-wizard"></div>\n                </dialog>'),H(window.hikodialogbuttons);window.hikodialog.showModal()}function w(e){var t,n;if(!p.onetap.email_marketing&&null!==(t=p.onetap.marketing)&&void 0!==t&&t.enable?"block":p.onetap.email_marketing&&null!==(n=p.onetap.statement)&&void 0!==n&&n.enable?"statement":null)if(e)h||(h=!0,document.dispatchEvent(new CustomEvent("onetap",{detail:{action:"display",type:"iframe",width:e}})));else{var o=document.getElementById(a).querySelector("iframe");"0px"===getComputedStyle(o).getPropertyValue("bottom")&&document.dispatchEvent(new CustomEvent("onetap",{detail:{action:"display",type:"iframe"}}))}}function k(e){var t={};return e.replace(/[?&]+([^=&]+)=([^&]*)/gi,(function(e,n,o){return t[n]=o})),t}function S(t,o){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(n.debug("ajax send ".concat(o)),++window.HIKO.ajax_calls>e)throw new Error("possible infinite met");return new Promise((function(e,n){var a=new XMLHttpRequest,r=function(e){var t=[];for(var n in e)t.push("".concat(n,"=").concat(encodeURIComponent(""+e[n]||"")));return t.join("&")}(_objectSpread(_objectSpread({},i),{},{href:encodeURIComponent(location.href),locale:u}));"POST"===t?(a.open("POST","".concat(location.origin).concat(o),!0),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded")):a.open("GET",o.indexOf("http")<0?"https://apps.hiko.link".concat(o,"?").concat(r):o),a.onload=function(){204===a.status?e({}):200===a.status?e(JSON.parse(a.responseText)):n()},a.send(r)}))}function _(e){var t=sessionStorage.getItem(e);if(t)return JSON.parse(t)}function x(e,t){if(!e&&"string"!=typeof e)return n.error("invalid storage set");if(t)if(t.error){var o=JSON.parse(JSON.stringify(t));delete o.error,sessionStorage.setItem(e,JSON.stringify(o))}else sessionStorage.setItem(e,JSON.stringify(t));else sessionStorage.removeItem(e)}function E(e,t){x(e,_objectSpread(_objectSpread({},_(e)||{}),t))}function A(e){var t,o;if(null!==(t=p.onetap)&&void 0!==t&&t.enable&&!/.*\/account/.test(location.pathname))if(!(/(iPod|iPhone|iPad)/.test(navigator.userAgent)||/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent))||p.onetap.safari)if(function(e){for(var t=e+"=",n=document.cookie.split(";"),o=0;o<n.length;o++){for(var i=n[o];" "==i.charAt(0);)i=i.substring(1,i.length);if(0==i.indexOf(t))return i.substring(t.length,i.length)}return null}("onet"))n.warn("one tap supressed");else{var i=(null===(o=p.onetap.position)||void 0===o?void 0:o.maxWidth)||480;if(!1===p.onetap.mobile&&i>=window.innerWidth)n.debug("mobile disabled for width ".concat(window.innerWidth));else{!0===p.events&&(f=!0);var a=e||p.onetap.custom?q:C;p.onetap.delay?isNaN(p.onetap.delay)||setTimeout((function(){n.debug("delay due "+p.onetap.delay),a(O,e)}),1e3*p.onetap.delay):a(O,e)}}else n.warn("one tap not supported")}function O(e){var t,i=_objectSpread(_objectSpread({},e),{},{href:encodeURIComponent(location.href),locale:u,cip:(null===(t=p.ip)||void 0===t?void 0:t.address)||""}),a=document.getElementById(r);if(a){var c=a.querySelector('input[type="checkbox"]');c&&(i.checked=""+c.checked,n.debug("one tap marketing conent ".concat(c.checked)))}f&&document.dispatchEvent(new CustomEvent("hiko",{detail:{action:"onetap",social:"google"}})),document.dispatchEvent(new CustomEvent("onetap",{detail:{action:"hide"}})),E(o,{click:"google"}),S("POST","/apps/authapp/onetap",i).then((function(e){e&&(e.token?(Z(),L(e)):e.multipass?(Z(),j(e)):(Z(),P(e)))}))}function j(e){f&&document.dispatchEvent(new CustomEvent("hiko",{detail:{action:"multipass",email:e.email,customer_id:e.customer_id,new_customer:e.new_customer}})),window.location.replace(e.multipass),t.enable&&x(t.key,t)}function T(e){n.debug(e),"display"===(null==e?void 0:e.g)&&null!=e&&e.h&&(n.debug("one tap block display"),function(){var e,t,n=document.getElementById(a);if(n){var o=!p.onetap.email_marketing&&null!==(e=p.onetap.marketing)&&void 0!==e&&e.enable?"block":p.onetap.email_marketing&&null!==(t=p.onetap.statement)&&void 0!==t&&t.enable?"statement":null;o&&document.dispatchEvent(new CustomEvent("onetap",{detail:{action:"display",type:o}})),new MutationObserver((function(e){e.forEach((function(e){if("attributes"===e.type&&"credential_picker_container"===e.target.id&&!h){h=!0;var t=n.querySelector("iframe");o&&document.dispatchEvent(new CustomEvent("onetap",{detail:{action:"display",type:o,width:t.offsetWidth}}))}}))})).observe(n,{subtree:!0,attributes:!0})}}(),S("POST","/apps/authapp/event",{name:"onetappop",path:location.pathname}).catch((function(e){return n.error(e.message)}))),"skipped"===(null==e?void 0:e.g)&&(n.debug("one tap block skipped"),document.dispatchEvent(new CustomEvent("onetap",{detail:{action:"hide"}})))}function q(e,t){var o,i,r="onetap".concat((new Date).getTime());if(window[r]=e,t)n.debug("pop block in fedcm"),document.body.insertAdjacentHTML("beforeend",'<div id="'.concat(a,'"\n                        data-client_id="').concat(p.onetap.id,'"\n                        data-callback="').concat(r,'"\n                        data-itp_support="true"\n                        data-use_fedcm_for_prompt="true">\n                </div>'));else{var c,d,l,u=(null===(c=p.onetap.position)||void 0===c?void 0:c.right)||20,s=(null===(d=p.onetap.position)||void 0===d?void 0:d.top)||20,f=(null===(l=p.onetap.position)||void 0===l?void 0:l.zIndex)||999,h="momentCallback".concat((new Date).getTime());window[h]=T,n.debug("pop block location ".concat(u,", ").concat(s,", ").concat(f)),document.body.insertAdjacentHTML("beforeend",'<div id="'.concat(a,'"\n                    data-client_id="').concat(p.onetap.id,'"\n                    data-prompt_parent_id="').concat(a,'"\n                    data-callback="').concat(r,'"\n                    data-itp_support="true"\n                    data-moment_callback="').concat(h,'"\n                    style="position: absolute; right: ').concat(u,"px; top: ").concat(s,"px;  z-index: ").concat(f,';">\n                </div>'))}i=(o="https://accounts.google.com/gsi/client").indexOf("http")>=0?o:"https://apps.hiko.link".concat(o),document.querySelectorAll('script[src^="'.concat(i,'"]')).length>0?Promise.resolve():new Promise((function(e){var t=document.createElement("script");t.src=i,t.defer="defer",t.async="async",t.onload=function(){n.debug("".concat(o," loaded")),e()},document.head.appendChild(t)}))}function C(e){var t,o,i,r;n.debug("poping one tap");var c="_".concat(Math.round(1e7*Math.random()).toString(36)),d=(null===(t=p.onetap.position)||void 0===t?void 0:t.right)||20,l=(null===(o=p.onetap.position)||void 0===o?void 0:o.top)||20,u=(null===(i=p.onetap.position)||void 0===i?void 0:i.zIndex)||999;n.debug("popping one tap frame ".concat(c,", ").concat(d,", ").concat(l,", ").concat(u));var s=document.createElement("style");s.innerHTML="\n              .".concat(c,"cz {position: fixed !important;  right: ").concat(d,"px; top: ").concat(l,"px;  z-index: ").concat(u,";}\n              .").concat(c,"z { border: none; }\n              @media screen and (max-width: ").concat((null===(r=p.onetap.position)||void 0===r?void 0:r.maxWidth)||480,"px) { .").concat(c,"z { position: fixed; bottom: 0px; left: 0px; z-index: 2147483647; width: 100%; height: 239px;  border: none; } }\n            ");var f=W('<div id="'.concat(a,'" style="display: none;" class="').concat(c,'cz"/>')),h=W('<iframe class="'.concat(c,'z" src="https://apps.hiko.software/js/assets/tap.html?v=').concat((new Date).getTime(),"&client=").concat(p.onetap.id,'"></iframe>'));f.append(h),document.body.append(s),document.body.append(f),w(),window.addEventListener("message",(function(t){if("size"===t.data.type)h.style.height=t.data.height+"px",n.debug("one tap popup with (".concat(t.data.width,", ").concat(t.data.height,")")),w(t.data.width);else if("notification"===t.data.type){var o=t.data.notification.g,i=t.data.notification.h;n.debug("".concat(o," one tap, ").concat(JSON.stringify(t.data.notification))),"display"===o?!0===i?(f.style.display="block",S("POST","/apps/authapp/event",{name:"onetappop",path:location.pathname}).catch((function(e){return n.error(e.message)})),document.dispatchEvent(new CustomEvent("hiko",{detail:{action:"popup",social:"google"}}))):!1===i&&(n.debug("display false"),f.remove()):"skipped"==o&&(f.style.display="none","user_cancel"===t.data.notification.l&&(!function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=new Date;o.setTime(o.getTime()+24*n*60*60*1e3);var i="; expires="+o.toGMTString();document.cookie=e+"="+t+i+"; path=/"}("onet",t.data.notification.m),n.debug("user_cancel one tap")),document.dispatchEvent(new CustomEvent("onetap",{detail:{action:"hide"}})))}else"credential"===t.data.type&&e(t.data.token)}))}function P(e){f&&document.dispatchEvent(new CustomEvent("hiko",{detail:{action:"login",email:e.email,customer_id:e.id}})),M(e.contextpath,{form_type:"customer_login","customer[email]":{value:e.email,style:"border: none; height: 1px; width: 1px;"},"customer[password]":e.password},{display:"block"})}function L(e){f&&document.dispatchEvent(new CustomEvent("hiko",{detail:{action:"activate",customer_id:e.id}})),M(e.contextpath,{"customer[password]":e.password,"customer[password_confirmation]":e.password,token:e.token,utf8:"✓",id:e.id})}function M(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{display:"none"},i=W('<form method="post" action="'.concat(e,'" style="display: ').concat(o.display,';"/>'));"none"!==o.display&&i.insertAdjacentHTML("beforeend",'<div name="hiko-container" ignore></div>'),document.body.prepend(i);var a=null;for(var r in t){var c=document.createElement("input");c.setAttribute("name",r),i.appendChild(c),"object"===_typeof(t[r])?(c.setAttribute("value",t[r].value),t[r].style&&(c.setAttribute("style",t[r].style),a=c)):(c.setAttribute("value",t[r]),c.setAttribute("hidden",!0))}"customer_login"===t.form_type&&window.Shopify.captcha?(i.setAttribute("data-shopify-captcha",!0),a&&a.focus(),setTimeout((function(){return window.Shopify.captcha.protect(i,(function(){n.debug("shopify captcha submit"),i.submit()}))}),3e3)):i.submit()}function z(){var e=function(){var e=document.querySelectorAll('div[name="hiko-container"]');if(e.length){var t,o=[],i=!1,a=_createForOfIteratorHelper(e);try{var r=function(){var e=t.value;""===e.getAttribute("ignore")?(i=!0,n.debug("ignore container"),e.querySelectorAll("div[data]").forEach((function(t){return t.onclick=function(){return R({button:t,container:e})}})),document.head.insertAdjacentHTML("beforeend",'<style id="hikoimages">'.concat(p.images,"</style>"))):o.push(e)};for(a.s();!(t=a.n()).done;)r()}catch(e){a.e(e)}finally{a.f()}return i?[]:o}if(/^(\/[a-zA-Z]{2,3}(-[a-zA-Z]{2})?)?\/cart($|\?)/.test(location.pathname))return[];var c=document.querySelectorAll('form[action*="/account"]'),d=[];return c.forEach((function(e){var t;if(!(e.querySelector('div[name="hiko-container"]')||(null===(t=e.action)||void 0===t?void 0:t.indexOf("/account/recover"))>=0))if(null!==e.querySelector("input[type=email]")||"portal-bosque.myshopify.com"!==l)if(e.querySelector('input[name="checkout_url"]')&&e.querySelector('input[name="guest"]'))n.debug("gest form, skip container");else if(e.querySelectorAll("input").length<=2)n.debug("fake customer login for invoke recaptcha");else{var o=e.action.indexOf("/account/login")>=0?W('<div name="hiko-container" type="login" app/>'):W('<div name="hiko-container" type="register" app/>');"top"===p.position?e.prepend(o):e.append(o),d.push(o)}else n.debug("no input email, skip container")})),d}();!0===p.events&&(f=!0),(null==e?void 0:e.length)>0&&(I(),e.forEach(H)),function(){var e,t=p,n=t.marketing,o=t.marketing_option,a=t.ip,r=_createForOfIteratorHelper(document.querySelectorAll('form[action*="/account"]'));try{var c=function(){var t=e.value;t.addEventListener("submit",(function(){var e,r,c=null===(e=t.querySelector('input[name="customer[password]"]'))||void 0===e?void 0:e.value,d=null===(r=t.querySelector('input[name="customer[email]"]'))||void 0===r?void 0:r.value,l=encodeURIComponent(Math.random().toString(36).substring(5)),u={id:l,email:d};if(null!=a&&a.address&&(u.cip=a.address),"always"===o||"always_register"===o)u.mkt="true";else if(n){var s=document.querySelector('input[name="'.concat(n,'"][type="checkbox"]'));s&&(u.mkt=s.checked)}d&&c&&l&&(x(i,l),S("POST","/apps/authapp/user",u))}))};for(r.s();!(e=r.n()).done;)c()}catch(e){r.e(e)}finally{r.f()}}()}function I(){document.querySelectorAll("#hikostyles").forEach((function(e){return e.remove()})),document.querySelectorAll("#hikoimages").forEach((function(e){return e.remove()})),document.head.insertAdjacentHTML("beforeend",'<style id="hikostyles">'.concat(p.css,"</style>")),document.head.insertAdjacentHTML("beforeend",'<style id="hikoimages">'.concat(p.images,"</style>"))}function H(e){var t=e.getAttribute("type")||"login",o=p.html[t];if(window.hikodialog&&window.hikodialog.contains(e)){document.body.insertAdjacentHTML("beforeend",'<div id="hikopsudo">'.concat(o,"</div>"));var i=window.hikopsudo.querySelector(".h_divider"),a=window.hikopsudo.querySelector(".h_buttons"),r=window.hikopsudo.querySelector('div[name="hiko-err"]');window.hikopsudo.remove();var c=a;e.appendChild(r),e.appendChild(a),i&&(e.appendChild(i),c=i),c.insertAdjacentHTML("afterend",'<label>Sign-in with email link</label>\n                <input type="email" autocomplete="email" autocorrect="off" autocapitalize="off" placeholder="Email" value="">\n                <button>Send me a sign-in link</button>'),e.insertAdjacentHTML("afterend",'<div id="hiko-popup-message" style="display: none;">\n                    <div class="back"> < Back </div>\n                    <h3>Check your email</h3>\n                    <p>We have sent you a link via email. Follow the link to sign-in.</p>\n                        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="#000000" height="48px" width="48px" class="center" version="1.1" id="Capa_1" viewBox="0 0 75.294 75.294" xml:space="preserve">\n                            <g>\n                                <path d="M66.097,12.089h-56.9C4.126,12.089,0,16.215,0,21.286v32.722c0,5.071,4.126,9.197,9.197,9.197h56.9   c5.071,0,9.197-4.126,9.197-9.197V21.287C75.295,16.215,71.169,12.089,66.097,12.089z M61.603,18.089L37.647,33.523L13.691,18.089   H61.603z M66.097,57.206h-56.9C7.434,57.206,6,55.771,6,54.009V21.457l29.796,19.16c0.04,0.025,0.083,0.042,0.124,0.065   c0.043,0.024,0.087,0.047,0.131,0.069c0.231,0.119,0.469,0.215,0.712,0.278c0.025,0.007,0.05,0.01,0.075,0.016   c0.267,0.063,0.537,0.102,0.807,0.102c0.001,0,0.002,0,0.002,0c0.002,0,0.003,0,0.004,0c0.27,0,0.54-0.038,0.807-0.102   c0.025-0.006,0.05-0.009,0.075-0.016c0.243-0.063,0.48-0.159,0.712-0.278c0.044-0.022,0.088-0.045,0.131-0.069   c0.041-0.023,0.084-0.04,0.124-0.065l29.796-19.16v32.551C69.295,55.771,67.86,57.206,66.097,57.206z"/>\n                            </g>\n                        </svg>\n                    <div>Don\'t receive the sign-in email? <div class="back"> Resend </div></div>\n                </div>');var l=e.querySelector("button"),u=e.querySelector("input"),s=window.hikodialog.querySelector("#hiko-popup-message");s.querySelectorAll(".back").forEach((function(t){return t.onclick=function(){n.debug("back"),e.style="display: flex;",s.style="display: none;"}})),l.onclick=function(){d.test(u.value)&&N(e,u,s,l)},u.addEventListener("keypress",(function(t){d.test(u.value)?(u.style="border-color: black;","Enter"===t.key&&N(e,u,s,l)):u.style="border-color: red;"}))}else e.innerHTML="",e.insertAdjacentHTML("afterbegin",o);!function(e){var t=e.querySelector(".".concat(p.classes.consent)),n=e.querySelectorAll(".".concat(p.classes.buttons," > div"));n.forEach((function(n){return n.onclick=function(){return R({button:n,consent:t,classes:p.classes,marketing:p.marketing,marketing_option:p.marketing_option,container:e})}}))}(e)}function N(e,t,o,i){return i.textContent="Sending ....",i.onclick=null,S("POST","/apps/authapp/link",{email:t.value}).then((function(t){e.style="display: none;",o.style="display: block;",n.info(t)})).catch((function(e){n.error(e.message)})).finally((function(){i.textContent="Sign-in with email link",i.onclick=function(){return N(e,t,o,i)}}))}function R(e){var t,i,a,r=e.button,d=e.consent,s=e.classes,h=e.marketing,m=e.marketing_option,v=e.container,g=r.getAttribute("data");if(n.debug("".concat(g," clicked")),f&&document.dispatchEvent(new CustomEvent("hiko",{detail:{social:g,action:"click"}})),d){var y=d.querySelector("input");if(y){if(!1===y.checked)return d.setAttribute("class",s.consent+" "+s.disagree);d.setAttribute("class",s.consent)}}var b={google:window.innerWidth<768?{width:450,height:680}:window.innerWidth>970?{width:970,height:700}:{width:768,height:700},facebook:{width:520,height:700},spotify:{width:520,height:470},twitter:{width:700,height:800},linkedin:{width:480,height:580},amazon:{width:420,height:580},line:window.innerWidth<768?{width:400,height:730}:{width:768,height:730},snapchat:{width:400,height:730},kakao:window.innerWidth<768?{width:400,height:680}:{width:768,height:680},tumblr:{width:430,height:760},twitch:{width:400,height:370},discord:{width:500,height:730},reddit:{width:860,height:620},vk:{width:680,height:450},tiktok:{width:400,height:620}},w=(null===(t=b[g])||void 0===t?void 0:t.width)||400,k=(null===(i=b[g])||void 0===i?void 0:i.height)||580;E(o,{click:g});var S=function(){if("always"===m||"always_register"===m)return"true";if(h){var e=document.querySelector('input[name="'.concat(h,'"][type="checkbox"]'));if(e)return e.checked}return""}(),A=encodeURIComponent(location.href),O=(new Date).getTime(),j=(null==v?void 0:v.getAttribute("register_tag"))||"",T=(null===(a=p.ip)||void 0===a?void 0:a.address)||"",q=encodeURIComponent(_(c)||"");x(c,"");try{window.addEventListener("message",U,!1),window.open("https://apps.hiko.link/js/login.html?social=".concat(g,"&shop=").concat(l,"&href=").concat(A,"&locale=").concat(u,"&mkt=").concat(S,"&register_tag=").concat(j,"&cip=").concat(T,"&visited=").concat(q,"&ts=").concat(O),"Login social","toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width=".concat(w,", height=").concat(k)).focus()}catch(e){n.debug("redirecting ..."),M("https://apps.hiko.link/admin/auth",{social:g,shop:l,href:A,locale:u})}}function U(e){n.debug("received from popup ".concat(e.origin)),e.data.en&&D(e.data.en).then(J)}function D(e){var t=new TextEncoder("hex"),n=new TextDecoder("utf8");return crypto.subtle.importKey("raw",t.encode(l.substring(0,16)),"AES-GCM",!0,["decrypt"]).then((function(n){return crypto.subtle.decrypt({name:"AES-GCM",iv:t.encode(l.replace(".","").substring(0,16))},n,new Uint8Array(e.match(/../g).map((function(e){return parseInt(e,16)}))).buffer)})).then((function(e){return JSON.parse(n.decode(e))}))}function J(e){"login"===e.name?(Z(),P(e.data)):"multipass"===e.name?(Z(),j(e.data)):"activate"===e.name?(Z(),L(e.data)):"error"===e.name&&function(e){var t=e.code,n=e.type,o=e.email,i=e.message;f&&document.dispatchEvent(new CustomEvent("hiko",{detail:{action:"error",message:i}}));if(o&&541===t){var a=document.querySelectorAll('input[name="customer[email]"]');a.length&&a.forEach((function(e){return e.value=o}))}document.querySelectorAll('div[name="hiko-err"]').forEach((function(e){e.innerHTML="";var t=document.createElement("div");e.append(t),"error"===n?t.insertAdjacentHTML("beforeend",'<div style="display: flex; flex-wrap: wrap; color: red; text-align: left;">'.concat(i,"</div>")):t.insertAdjacentHTML("beforeend",'<div style="display: flex; flex-wrap: wrap; text-align: left;">'.concat(i,"</div>"))}))}(e.data)}function K(e){if(null!=e&&e.avatar){var t=function(e){var t=e.first_name,n=e.last_name;if(!t&&!n)return"";if(t&&n)return"".concat(t," ").concat(n);if(t)return t;if(n)return n}(e),n=document.querySelectorAll('[name="hiko-avatar"]');if(n.length)n.forEach((function(n){if(e.avatar){if("IMG"===n.tagName)n.setAttribute("src",e.avatar),n.setAttribute("title",t);else if("A"===n.tagName){var o=n.querySelector("img");o?(o.setAttribute("src",e.avatar),o.setAttribute("title",t)):n.insertAdjacentHTML("beforeend",'<img src="'.concat(e.avatar,'" title="').concat(t,'"/>'))}n.style.dispay="block"}}));else if(/^(\/[a-zA-Z]{2,3}(-[a-zA-Z]{2})?)?\/account($|\?)/.test(location.pathname)){var o;if(null===(o=p.avatar)||void 0===o||!o.profile)return;var i=document.querySelector("a[href*='/account/addresses']");if(i){var a,r,c='<img src="'.concat(e.avatar,'" title="').concat(t,'" alt="').concat(t,'" style="border-radius: 20%;width: 64px;height: 64px;margin-top: 10px"/>');null!==(a=p.avatar)&&void 0!==a&&a.profile_link&&(c='<a href="'.concat(null===(r=p.avatar)||void 0===r?void 0:r.profile_link,'">').concat(c,"</a>"));var d=W(c);i.parentNode.after(d),d.after(W("<p><bold>".concat(t,"</bold></p>")))}}else{var l;if(null===(l=p.avatar)||void 0===l||!l.header)return;var u=document.querySelectorAll("a[href*='/account']");if(u.length){var s,f,h='<img src="'.concat(e.avatar,'" class="icon" title="').concat(t,'" alt="').concat(t,'" style="border-radius: 20%;width: 24px;height: 24px"/>');null!==(s=p.avatar)&&void 0!==s&&s.header_link&&(h='<a href="'.concat(null===(f=p.avatar)||void 0===f?void 0:f.header_link,'">').concat(h,"</a>"));var m=W(h);u.forEach((function(e){if(e.href&&e.href.match(/.*\/account$/)&&e.closest("header")){var t=e.cloneNode();t.append(m),e.after(t)}}))}}}}function W(e){var t=document.createElement("div");return t.innerHTML=e,1!==t.childElementCount&&n.error("childrens "+t.childElementCount+", "+e),t.firstChild}function Z(){("IFRAME"===document.activeElement.tagName?document.body:document.activeElement).insertAdjacentHTML("beforeend",'\n          <div class="hikoloading">\n            <div class="spinner">\n              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 4335 4335" width="50" height="50">\n                <path\n                  fill="black"\n                  d="M3346 1077c41,0 75,34 75,75 0,41 -34,75 -75,75 -41,0 -75,-34 -75,-75 0,-41 34,-75 75,-75zm-1198 -824c193,0 349,156 349,349 0,193 -156,349 -349,349 -193,0 -349,-156 -349,-349 0,-193 156,-349 349,-349zm-1116 546c151,0 274,123 274,274 0,151 -123,274 -274,274 -151,0 -274,-123 -274,-274 0,-151 123,-274 274,-274zm-500 1189c134,0 243,109 243,243 0,134 -109,243 -243,243 -134,0 -243,-109 -243,-243 0,-134 109,-243 243,-243zm500 1223c121,0 218,98 218,218 0,121 -98,218 -218,218 -121,0 -218,-98 -218,-218 0,-121 98,-218 218,-218zm1116 434c110,0 200,89 200,200 0,110 -89,200 -200,200 -110,0 -200,-89 -200,-200 0,-110 89,-200 200,-200zm1145 -434c81,0 147,66 147,147 0,81 -66,147 -147,147 -81,0 -147,-66 -147,-147 0,-81 66,-147 147,-147zm459 -1098c65,0 119,53 119,119 0,65 -53,119 -119,119 -65,0 -119,-53 -119,-119 0,-65 53,-119 119,-119z"\n                ></path>\n              </svg>\n            </div>\n          </div>')}}();